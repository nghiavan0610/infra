# =============================================================================
# Uptime Kuma - External Status Page & Monitoring
# =============================================================================
# Monitors your services from outside (unlike Prometheus which monitors internally)
#
# Usage:
#   docker network create infra  # If not using setup.sh
#   docker compose up -d
#   Open http://localhost:3001
# =============================================================================

services:
  uptime-kuma:
    image: louislam/uptime-kuma:1
    container_name: uptime-kuma
    restart: unless-stopped
    volumes:
      - uptime_kuma_data:/app/data
    ports:
      - "127.0.0.1:${UPTIME_KUMA_PORT:-3001}:3001"
    environment:
      - TZ=UTC
    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:3001/api/health', (r) => process.exit(r.statusCode === 200 ? 0 : 1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    deploy:
      resources:
        limits:
          memory: ${MEMORY_LIMIT:-256M}
          cpus: "${CPU_LIMIT:-0.5}"
    security_opt:
      - no-new-privileges:true
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    # -------------------------------------------------------------------------
    # Traefik Configuration (uncomment labels to enable)
    # -------------------------------------------------------------------------
    # labels:
    #   - "traefik.enable=true"
    #   - "traefik.http.routers.uptime-kuma.rule=Host(`${UPTIME_KUMA_DOMAIN:-status.example.com}`)"
    #   - "traefik.http.routers.uptime-kuma.entrypoints=websecure"
    #   - "traefik.http.routers.uptime-kuma.tls.certresolver=letsencrypt"
    #   - "traefik.http.services.uptime-kuma.loadbalancer.server.port=3001"
    networks:
      - infra

# =============================================================================
# Volumes
# =============================================================================
volumes:
  uptime_kuma_data:
    driver: local
    name: uptime_kuma_data

# =============================================================================
# Networks
# =============================================================================
networks:
  infra:
    external: true
    name: infra
