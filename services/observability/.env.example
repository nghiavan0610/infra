# =============================================================================
# Observability Stack Configuration (Alloy-based)
# =============================================================================
# Copy this file to .env and update the values
# DO NOT commit .env to version control!
#
# This stack uses Grafana Alloy as a unified collector, replacing:
#   - node-exporter (host metrics)
#   - cadvisor (container metrics)
#   - redis-exporter (redis metrics)
#   - otel-collector (OTLP receiver)
#   - promtail (log collection)
# =============================================================================

# -----------------------------------------------------------------------------
# Grafana
# -----------------------------------------------------------------------------
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
# Generate with: openssl rand -base64 32
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
GRAFANA_ROOT_URL=http://localhost:3000
# Set to true if using HTTPS
GRAFANA_COOKIE_SECURE=false

# -----------------------------------------------------------------------------
# Prometheus
# -----------------------------------------------------------------------------
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_TIME=15d
PROMETHEUS_RETENTION_SIZE=10GB

# -----------------------------------------------------------------------------
# Loki
# -----------------------------------------------------------------------------
LOKI_PORT=3100

# -----------------------------------------------------------------------------
# Tempo
# -----------------------------------------------------------------------------
TEMPO_PORT=3200

# -----------------------------------------------------------------------------
# Alertmanager
# -----------------------------------------------------------------------------
ALERTMANAGER_PORT=9093
ALERTMANAGER_EXTERNAL_URL=http://localhost:9093

# -----------------------------------------------------------------------------
# Grafana Alloy (Unified Telemetry Collector)
# -----------------------------------------------------------------------------
# OTLP endpoints for application instrumentation
OTEL_GRPC_PORT=4317
OTEL_HTTP_PORT=4318

# -----------------------------------------------------------------------------
# Database Exporters (Alloy built-in) - Leave empty to disable
# -----------------------------------------------------------------------------
# Redis
REDIS_PASSWORD=
REDIS_CACHE_ADDR=redis-cache:6379
REDIS_QUEUE_ADDR=redis-queue:6379

# PostgreSQL - Format: postgresql://user:password@host:port/dbname?sslmode=disable
POSTGRES_DSN=

# MongoDB - Format: mongodb://user:password@host:port
MONGODB_URI=

# MySQL - Format: user:password@tcp(host:port)/
MYSQL_DSN=

# Memcached - Format: host:port
MEMCACHED_ADDR=

# Kafka - Format: host:port
KAFKA_BROKERS=

# Elasticsearch/OpenSearch - Format: http://host:port
ELASTICSEARCH_URL=

# -----------------------------------------------------------------------------
# Services with Built-in Metrics (Alloy scrapes directly) - Leave empty to disable
# -----------------------------------------------------------------------------
NATS_ADDR=
RABBITMQ_ADDR=
TRAEFIK_ADDR=
CLICKHOUSE_ADDR=
MEILISEARCH_ADDR=
QDRANT_ADDR=
MINIO_ADDR=

# -----------------------------------------------------------------------------
# Security & Identity Services - Leave empty to disable
# -----------------------------------------------------------------------------
# Vault - Format: vault:8200 (requires telemetry enabled in vault config)
VAULT_ADDR=
# Authentik - Format: authentik-server:9300 (metrics port, not main port)
AUTHENTIK_ADDR=
# CrowdSec - Format: crowdsec:6060 (requires: cscli metrics enable)
CROWDSEC_ADDR=

# -----------------------------------------------------------------------------
# Development Tools - Leave empty to disable
# -----------------------------------------------------------------------------
# Gitea - Format: gitea:3000 (requires: [metrics] ENABLED=true in app.ini)
GITEA_ADDR=
# n8n - Format: n8n:5678 (requires: N8N_METRICS=true env var)
N8N_ADDR=

# -----------------------------------------------------------------------------
# Database Monitoring (Dynamic File-based Discovery)
# -----------------------------------------------------------------------------
# PostgreSQL and other targets are managed via JSON files in ./targets/
# Use the helper script to add/remove targets:
#
#   # Add PostgreSQL target
#   ./scripts/manage-targets.sh add postgres --name my-db --host host.docker.internal --port 9187
#
#   # List targets
#   ./scripts/manage-targets.sh list postgres
#
#   # Remove target
#   ./scripts/manage-targets.sh remove postgres --name my-db
#
# Changes are picked up automatically within 30 seconds (no restart needed)

# Garage S3 Storage (only service requiring auth for metrics)
# Get token: cat ../../storage/garage/.env | grep GARAGE_METRICS_TOKEN
# Then run: ./scripts/init-garage-token.sh
GARAGE_METRICS_TOKEN=

# -----------------------------------------------------------------------------
# Resource Limits (adjust based on your VPS)
# -----------------------------------------------------------------------------
# Small VPS (4GB RAM)
# PROMETHEUS_MEMORY_LIMIT=1G
# LOKI_MEMORY_LIMIT=512M
# TEMPO_MEMORY_LIMIT=512M
# GRAFANA_MEMORY_LIMIT=256M
# ALLOY_MEMORY_LIMIT=512M

# Medium VPS (8-16GB RAM) - DEFAULT
PROMETHEUS_MEMORY_LIMIT=2G
LOKI_MEMORY_LIMIT=1G
TEMPO_MEMORY_LIMIT=1G
GRAFANA_MEMORY_LIMIT=512M
ALLOY_MEMORY_LIMIT=1G
ALLOY_CPU_LIMIT=2

# Large VPS (32GB+ RAM)
# PROMETHEUS_MEMORY_LIMIT=4G
# LOKI_MEMORY_LIMIT=2G
# TEMPO_MEMORY_LIMIT=2G
# GRAFANA_MEMORY_LIMIT=1G
# ALLOY_MEMORY_LIMIT=2G

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Options: debug, info, warn, error
LOG_LEVEL=warn

# -----------------------------------------------------------------------------
# Alerting - Notification Channels
# -----------------------------------------------------------------------------
# Slack Webhook (get from: Slack App > Incoming Webhooks)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx/xxx/xxx

# Discord Webhook (get from: Server Settings > Integrations > Webhooks)
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/xxx/xxx

# Generic Webhook (for custom integrations)
ALERT_WEBHOOK_URL=http://localhost:9999/webhook
CRITICAL_WEBHOOK_URL=http://localhost:9999/critical

# Email addresses for alerts (comma-separated)
# ALERT_EMAIL_ADDRESSES=admin@example.com,ops@example.com

# -----------------------------------------------------------------------------
# Alert Toggles (enable/disable alert categories)
# -----------------------------------------------------------------------------
# Set to false to disable specific alert categories
# After changing, run: ./scripts/toggle-alerts.sh apply
#
ALERTS_INFRASTRUCTURE=true
ALERTS_CONTAINERS=true
ALERTS_OBSERVABILITY=true
ALERTS_POSTGRESQL=true
ALERTS_REDIS=true
ALERTS_NATS=true
ALERTS_RABBITMQ=true
ALERTS_MONGODB=true
ALERTS_TRAEFIK=true
ALERTS_GARAGE=true
ALERTS_TASK_QUEUE=true
ALERTS_APPLICATION=true
ALERTS_SECURITY=true

# -----------------------------------------------------------------------------
# SMTP Configuration (for email alerts)
# -----------------------------------------------------------------------------
SMTP_ENABLED=false
# SMTP_HOST=smtp.gmail.com:587
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# SMTP_FROM=grafana@yourdomain.com

# -----------------------------------------------------------------------------
# Traefik Integration (optional - uncomment if using Traefik)
# -----------------------------------------------------------------------------
# Domain names for Traefik routing (requires DNS configured)
# GRAFANA_DOMAIN=grafana.example.com
# PROMETHEUS_DOMAIN=prometheus.example.com

# =============================================================================
# Access URLs (after deployment):
# =============================================================================
# Without Traefik:
#   Grafana:      http://localhost:3000
#   Prometheus:   http://localhost:9090 (internal only - 127.0.0.1)
#   Loki:         http://localhost:3100 (internal only - 127.0.0.1)
#   Tempo:        http://localhost:3200 (internal only - 127.0.0.1)
#   Alertmanager: http://localhost:9093 (internal only - 127.0.0.1)
#   Alloy UI:     http://localhost:12345 (internal only - 127.0.0.1)
#   OTLP gRPC:    localhost:4317
#   OTLP HTTP:    localhost:4318
#
# With Traefik (after uncommenting labels in docker-compose.yml):
#   Grafana:      https://grafana.example.com
#   Prometheus:   https://prometheus.example.com (internal only by default)
#   Alertmanager: https://alertmanager.example.com (internal only by default)
# =============================================================================
