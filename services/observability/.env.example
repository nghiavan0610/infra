# =============================================================================
# Observability Stack Configuration
# =============================================================================
# Copy this file to .env and update the values
# DO NOT commit .env to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# Grafana
# -----------------------------------------------------------------------------
GRAFANA_PORT=3000
GRAFANA_ADMIN_USER=admin
# Generate with: openssl rand -base64 32
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
GRAFANA_ROOT_URL=http://localhost:3000
# Set to true if using HTTPS
GRAFANA_COOKIE_SECURE=false

# -----------------------------------------------------------------------------
# Prometheus
# -----------------------------------------------------------------------------
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_TIME=15d
PROMETHEUS_RETENTION_SIZE=10GB

# -----------------------------------------------------------------------------
# Loki
# -----------------------------------------------------------------------------
LOKI_PORT=3100

# -----------------------------------------------------------------------------
# Tempo
# -----------------------------------------------------------------------------
TEMPO_PORT=3200

# -----------------------------------------------------------------------------
# Alertmanager
# -----------------------------------------------------------------------------
ALERTMANAGER_PORT=9093

# -----------------------------------------------------------------------------
# Database Monitoring (Dynamic File-based Discovery)
# -----------------------------------------------------------------------------
# PostgreSQL and Redis targets are managed via JSON files in ./targets/
# Use the helper script to add/remove targets:
#
#   # Add PostgreSQL target
#   ./scripts/manage-targets.sh add postgres --name my-db --host host.docker.internal --port 9187
#
#   # Add Redis target
#   ./scripts/manage-targets.sh add redis --name redis-cache --host host.docker.internal --port 6379
#
#   # List targets
#   ./scripts/manage-targets.sh list postgres
#   ./scripts/manage-targets.sh list redis
#
#   # Remove target
#   ./scripts/manage-targets.sh remove postgres --name my-db
#
# Changes are picked up automatically within 30 seconds (no restart needed)

# Redis Exporter (Multi-target mode - single exporter for all Redis instances)
REDIS_EXPORTER_PORT=9121

# Garage S3 Storage (only service requiring auth for metrics)
# Get token: cat ../../storage/garage/.env | grep GARAGE_METRICS_TOKEN
# Then run: ./scripts/init-garage-token.sh
GARAGE_METRICS_TOKEN=

# PostgreSQL Exporters run alongside each database stack
# See templates/postgres-exporter.yml for how to add to your database
# Or enable the built-in exporter in postgres-single:
#   cd postgres-single && docker compose --profile monitoring up -d

# -----------------------------------------------------------------------------
# OpenTelemetry Collector
# -----------------------------------------------------------------------------
OTEL_GRPC_PORT=4317
OTEL_HTTP_PORT=4318
OTEL_METRICS_PORT=8888
OTEL_PROMETHEUS_PORT=8889

# -----------------------------------------------------------------------------
# Resource Limits (adjust based on your VPS)
# -----------------------------------------------------------------------------
# Small VPS (4GB RAM)
# PROMETHEUS_MEMORY_LIMIT=1G
# LOKI_MEMORY_LIMIT=512M
# TEMPO_MEMORY_LIMIT=512M
# GRAFANA_MEMORY_LIMIT=256M
# OTEL_MEMORY_LIMIT=256M

# Medium VPS (8-16GB RAM) - DEFAULT
PROMETHEUS_MEMORY_LIMIT=2G
PROMETHEUS_MEMORY_RESERVATION=512M
LOKI_MEMORY_LIMIT=1G
LOKI_MEMORY_RESERVATION=256M
TEMPO_MEMORY_LIMIT=1G
TEMPO_MEMORY_RESERVATION=256M
GRAFANA_MEMORY_LIMIT=512M
GRAFANA_MEMORY_RESERVATION=128M
OTEL_MEMORY_LIMIT=512M
OTEL_MEMORY_RESERVATION=128M

# Large VPS (32GB+ RAM)
# PROMETHEUS_MEMORY_LIMIT=4G
# LOKI_MEMORY_LIMIT=2G
# TEMPO_MEMORY_LIMIT=2G
# GRAFANA_MEMORY_LIMIT=1G
# OTEL_MEMORY_LIMIT=1G

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Options: debug, info, warn, error
LOG_LEVEL=warn

# -----------------------------------------------------------------------------
# Alerting - Notification Channels
# -----------------------------------------------------------------------------
# Slack Webhook (get from: Slack App > Incoming Webhooks)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx/xxx/xxx

# Discord Webhook (get from: Server Settings > Integrations > Webhooks)
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/xxx/xxx

# Generic Webhook (for custom integrations)
ALERT_WEBHOOK_URL=http://localhost:9999/webhook
CRITICAL_WEBHOOK_URL=http://localhost:9999/critical

# Email addresses for alerts (comma-separated)
# ALERT_EMAIL_ADDRESSES=admin@example.com,ops@example.com

# -----------------------------------------------------------------------------
# Alert Toggles (enable/disable alert categories)
# -----------------------------------------------------------------------------
# Set to false to disable specific alert categories
# After changing, run: ./scripts/toggle-alerts.sh apply
#
ALERTS_INFRASTRUCTURE=true
ALERTS_CONTAINERS=true
ALERTS_OBSERVABILITY=true
ALERTS_POSTGRESQL=true
ALERTS_REDIS=true
ALERTS_NATS=true
ALERTS_RABBITMQ=true
ALERTS_MONGODB=true
ALERTS_TRAEFIK=true
ALERTS_GARAGE=true
ALERTS_TASK_QUEUE=true
ALERTS_APPLICATION=true
ALERTS_SECURITY=true

# -----------------------------------------------------------------------------
# SMTP Configuration (for email alerts)
# -----------------------------------------------------------------------------
SMTP_ENABLED=false
# SMTP_HOST=smtp.gmail.com:587
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# SMTP_FROM=grafana@yourdomain.com

# -----------------------------------------------------------------------------
# Traefik Integration (optional - uncomment if using Traefik)
# -----------------------------------------------------------------------------
# Domain names for Traefik routing (requires DNS configured)
# GRAFANA_DOMAIN=grafana.example.com
# PROMETHEUS_DOMAIN=prometheus.example.com

# =============================================================================
# Access URLs (after deployment):
# =============================================================================
# Without Traefik:
#   Grafana:      http://localhost:3000
#   Prometheus:   http://localhost:9090
#   Loki:         http://localhost:3100
#   Tempo:        http://localhost:3200
#   Alertmanager: http://localhost:9093
#   OTLP gRPC:    localhost:4317
#   OTLP HTTP:    localhost:4318
#
# Note: Internal ports (bound to 127.0.0.1) are only accessible from the host:
#   PostgreSQL Exporter: http://127.0.0.1:9187/metrics
#   Redis Exporter:      http://127.0.0.1:9121/metrics
#
# With Traefik (after uncommenting labels in docker-compose.yml):
#   Grafana:      https://grafana.example.com
#   Prometheus:   https://prometheus.example.com (internal only by default)
#   Alertmanager: https://alertmanager.example.com (internal only by default)
# =============================================================================
