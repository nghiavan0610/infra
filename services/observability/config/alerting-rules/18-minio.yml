# =============================================================================
# MinIO Alerting Rules
# =============================================================================

groups:
  - name: minio
    rules:
      # -----------------------------------------
      # Availability Alerts
      # -----------------------------------------
      - alert: MinIODown
        expr: up{job="minio"} == 0
        for: 1m
        labels:
          severity: critical
          service: minio
        annotations:
          summary: "MinIO instance down"
          description: "MinIO instance {{ $labels.instance }} is down"

      # -----------------------------------------
      # Storage Alerts
      # -----------------------------------------
      - alert: MinIODiskSpaceLow
        expr: minio_cluster_disk_free_bytes / minio_cluster_disk_total_bytes * 100 < 20
        for: 5m
        labels:
          severity: warning
          service: minio
        annotations:
          summary: "MinIO disk space low"
          description: "MinIO {{ $labels.instance }} has only {{ $value | printf \"%.1f\" }}% disk space free"

      - alert: MinIODiskSpaceCritical
        expr: minio_cluster_disk_free_bytes / minio_cluster_disk_total_bytes * 100 < 10
        for: 1m
        labels:
          severity: critical
          service: minio
        annotations:
          summary: "MinIO disk space critical"
          description: "MinIO {{ $labels.instance }} has only {{ $value | printf \"%.1f\" }}% disk space free"

      # -----------------------------------------
      # Health Alerts
      # -----------------------------------------
      - alert: MinIODiskOffline
        expr: minio_cluster_disk_offline_total > 0
        for: 5m
        labels:
          severity: critical
          service: minio
        annotations:
          summary: "MinIO disk offline"
          description: "MinIO {{ $labels.instance }} has {{ $value }} offline disks"

      - alert: MinIONodeOffline
        expr: minio_cluster_nodes_offline_total > 0
        for: 5m
        labels:
          severity: critical
          service: minio
        annotations:
          summary: "MinIO node offline"
          description: "MinIO cluster has {{ $value }} offline nodes"

      # -----------------------------------------
      # Performance Alerts
      # -----------------------------------------
      - alert: MinIORequestErrors
        expr: rate(minio_s3_requests_errors_total[5m]) > 1
        for: 5m
        labels:
          severity: warning
          service: minio
        annotations:
          summary: "MinIO request errors"
          description: "MinIO {{ $labels.instance }} has {{ $value | printf \"%.1f\" }} errors/sec"

      - alert: MinIOHighLatency
        expr: histogram_quantile(0.99, rate(minio_s3_requests_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
          service: minio
        annotations:
          summary: "MinIO high latency"
          description: "MinIO {{ $labels.instance }} p99 latency is {{ $value | printf \"%.2f\" }}s"
