# =============================================================================
# Redis Cache Configuration
# =============================================================================
# Optimized for caching: volatile data, LRU eviction, minimal persistence
# =============================================================================

# -----------------------------------------------------------------------------
# Network
# -----------------------------------------------------------------------------
bind 0.0.0.0
port 6379
protected-mode yes
tcp-backlog 511
tcp-keepalive 300
timeout 0

# -----------------------------------------------------------------------------
# General
# -----------------------------------------------------------------------------
daemonize no
pidfile /var/run/redis/redis-server.pid
loglevel notice
logfile ""
databases 16

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
# Password is set via command line (--requirepass)
# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG "CONFIG_c4ch3_s3cr3t"
rename-command SHUTDOWN "SHUTDOWN_c4ch3_s3cr3t"

# -----------------------------------------------------------------------------
# Memory Management
# -----------------------------------------------------------------------------
# Max memory for cache (adjust based on VPS RAM)
# Small VPS (1-2GB RAM): 256mb
# Medium VPS (4-8GB RAM): 512mb-1gb
# Large VPS (16GB+ RAM): 2-4gb
# 10GB multi-app server: 512mb (conservative)
maxmemory 512mb

# Eviction policy: Remove least recently used keys when full
# This is ideal for cache - old data gets evicted automatically
maxmemory-policy allkeys-lru

# LRU samples (higher = more accurate eviction)
maxmemory-samples 10

# -----------------------------------------------------------------------------
# Persistence - DISABLED for Cache
# -----------------------------------------------------------------------------
# No RDB snapshots (data is volatile)
save ""

# No AOF (data is volatile)
appendonly no

# Working directory (for any temp files)
dir /data

# -----------------------------------------------------------------------------
# Slow Log
# -----------------------------------------------------------------------------
slowlog-log-slower-than 10000
slowlog-max-len 128

# -----------------------------------------------------------------------------
# Latency Monitor
# -----------------------------------------------------------------------------
latency-monitor-threshold 100

# -----------------------------------------------------------------------------
# Client Output Buffer Limits
# -----------------------------------------------------------------------------
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# -----------------------------------------------------------------------------
# Clients
# -----------------------------------------------------------------------------
maxclients 10000

# -----------------------------------------------------------------------------
# Lazy Freeing (Background deletion)
# -----------------------------------------------------------------------------
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
lazyfree-lazy-user-del yes
lazyfree-lazy-user-flush yes

# -----------------------------------------------------------------------------
# Active Defragmentation
# -----------------------------------------------------------------------------
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100
active-defrag-cycle-min 1
active-defrag-cycle-max 25
