services:
  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    restart: unless-stopped
    environment:
      # Update schedule (default: daily at 4 AM)
      - WATCHTOWER_SCHEDULE=${WATCHTOWER_SCHEDULE:-0 0 4 * * *}
      # Cleanup old images after update
      - WATCHTOWER_CLEANUP=true
      # Include stopped containers
      - WATCHTOWER_INCLUDE_STOPPED=${WATCHTOWER_INCLUDE_STOPPED:-false}
      # Revive stopped containers after update
      - WATCHTOWER_REVIVE_STOPPED=${WATCHTOWER_REVIVE_STOPPED:-false}
      # Rolling restart (one at a time)
      - WATCHTOWER_ROLLING_RESTART=${WATCHTOWER_ROLLING_RESTART:-false}
      # Notifications
      - WATCHTOWER_NOTIFICATIONS=${WATCHTOWER_NOTIFICATIONS:-}
      - WATCHTOWER_NOTIFICATION_URL=${WATCHTOWER_NOTIFICATION_URL:-}
      # Logging
      - WATCHTOWER_DEBUG=${WATCHTOWER_DEBUG:-false}
      # Label filtering (only update containers with label)
      - WATCHTOWER_LABEL_ENABLE=${WATCHTOWER_LABEL_ENABLE:-false}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    labels:
      # Self-update watchtower
      - "com.centurylinklabs.watchtower.enable=true"
    networks:
      - infra-network

networks:
  infra-network:
    external: true
