# =============================================================================
# RabbitMQ Configuration - Production
# =============================================================================
# High-performance message broker configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Networking
# -----------------------------------------------------------------------------
listeners.tcp.default = 5672

# Management UI
management.tcp.port = 15672

# Disable non-localhost guest access (security)
loopback_users.guest = true

# -----------------------------------------------------------------------------
# Authentication & Authorization
# -----------------------------------------------------------------------------
# Load definitions on startup (users, vhosts, permissions, policies)
load_definitions = /etc/rabbitmq/definitions.json

# Default authentication backend
auth_backends.1 = internal

# -----------------------------------------------------------------------------
# Resource Limits
# -----------------------------------------------------------------------------
# Memory high watermark (relative to total RAM)
vm_memory_high_watermark.relative = 0.7

# Memory high watermark paging ratio
vm_memory_high_watermark_paging_ratio = 0.5

# Disk free space limit (absolute)
disk_free_limit.absolute = 2GB

# -----------------------------------------------------------------------------
# Connection & Channel Limits
# -----------------------------------------------------------------------------
# Maximum number of channels per connection
channel_max = 128

# Heartbeat timeout (seconds)
heartbeat = 60

# Connection handshake timeout (milliseconds)
handshake_timeout = 30000

# -----------------------------------------------------------------------------
# Queue Configuration
# -----------------------------------------------------------------------------
# Default queue type (classic or quorum)
# Quorum queues are recommended for production (replicated, durable)
default_queue_type = quorum

# Queue master locator strategy
queue_master_locator = min-masters

# -----------------------------------------------------------------------------
# Message Configuration
# -----------------------------------------------------------------------------
# Maximum message size (bytes) - 128MB
max_message_size = 134217728

# Consumer timeout (milliseconds) - 30 minutes
# Consumers must ack within this time
consumer_timeout = 1800000

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
log.file = /var/log/rabbitmq/rabbit.log
log.file.level = info
log.file.rotation.size = 104857600
log.file.rotation.count = 5

# Log to console as well (for Docker)
log.console = true
log.console.level = info

# Disable colored output for cleaner logs
log.console.formatter = plaintext

# -----------------------------------------------------------------------------
# Statistics & Metrics
# -----------------------------------------------------------------------------
# Collect statistics interval (milliseconds)
collect_statistics_interval = 5000

# Management statistics rate mode
management.rates_mode = basic

# Prometheus metrics
prometheus.return_per_object_metrics = true

# -----------------------------------------------------------------------------
# Clustering (for HA setup)
# -----------------------------------------------------------------------------
# Cluster partition handling
cluster_partition_handling = pause_minority

# Cluster formation timeout
cluster_formation.peer_discovery_backend = rabbit_peer_discovery_classic_config

# -----------------------------------------------------------------------------
# SSL/TLS Configuration (uncomment for production)
# -----------------------------------------------------------------------------
# listeners.ssl.default = 5671
# ssl_options.cacertfile = /etc/rabbitmq/certs/ca.crt
# ssl_options.certfile = /etc/rabbitmq/certs/server.crt
# ssl_options.keyfile = /etc/rabbitmq/certs/server.key
# ssl_options.verify = verify_peer
# ssl_options.fail_if_no_peer_cert = false
# ssl_options.versions.1 = tlsv1.3
# ssl_options.versions.2 = tlsv1.2

# Management UI SSL
# management.ssl.port = 15671
# management.ssl.cacertfile = /etc/rabbitmq/certs/ca.crt
# management.ssl.certfile = /etc/rabbitmq/certs/server.crt
# management.ssl.keyfile = /etc/rabbitmq/certs/server.key

# -----------------------------------------------------------------------------
# Performance Tuning
# -----------------------------------------------------------------------------
# Number of acceptors for TCP listeners
num_acceptors.tcp = 10

# Credit flow settings - removed (not supported in RabbitMQ 4.0)
# credit_flow_default_credit.initial = 400
# credit_flow_default_credit.more = 200

# Background GC interval (milliseconds)
background_gc_enabled = true
background_gc_target_interval = 60000
